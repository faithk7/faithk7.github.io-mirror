---
layout: default
---

{% include toc.html html=content class="toc-container" %}

<div class="c-writing-post-meta-container">
    <h1 class="o-writing-post-title">{{ page.title | replace: "| Kai Qu", "" }}</h1>
    <div class="c-writing-post-date">{{ page.date | date: "%B %d, %Y" }}</div>
    <div class="c-writing-post-tag-container">
        {% for tag in page.tags %}
        <span class="o-writing-post-tag" data-theme="light">{{ tag }}</span>
        {% unless forloop.last %}<span style="margin-left: 2px; margin-right: 2px;"> / </span>{% endunless %}
        {% endfor %}
    </div>
    <div class="c-writing-post-container">
        <div class="o-writing-post-text" data-theme="light">
            {{ content }}
        </div>
    </div>
</div>

<script defer>
    document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('.o-writing-post-text a[href]').forEach(function (link) {
            try {
                var url = new URL(link.getAttribute('href'), location.href);
                if (url.origin === location.origin) return;
                link.setAttribute('target', '_blank');
                link.setAttribute('rel', 'noopener noreferrer');
            } catch (_) {
            }
        });

        var isScrolling = false;
        var scrollOffset = 5;

        function supportsSmoothScroll() {
            return 'scrollBehavior' in document.documentElement.style;
        }

        function getScrollTarget() {
            var container = document.querySelector('.l-center');
            if (container && container.scrollHeight > container.clientHeight) {
                return container;
            }
            return window;
        }

        function setScrollTop(target, top) {
            if (target === window) {
                if (supportsSmoothScroll()) {
                    window.scrollTo({ top: top, behavior: 'smooth' });
                } else {
                    document.documentElement.scrollTop = top;
                    document.body.scrollTop = top;
                }
                return;
            }

            if (supportsSmoothScroll() && target.scrollTo) {
                target.scrollTo({ top: top, behavior: 'smooth' });
            } else {
                target.scrollTop = top;
            }
        }

        function scrollToHash(hash) {
            if (isScrolling) return;

            var id = (hash || '').replace(/^#/, '');
            if (!id) return;
            var target = document.getElementById(decodeURIComponent(id));
            if (!target) return;
            var scrollTarget = getScrollTarget();

            isScrolling = true;

            if (scrollTarget === window) {
                var targetTop = target.getBoundingClientRect().top + window.pageYOffset - scrollOffset;
                setScrollTop(scrollTarget, targetTop);
            } else {
                var targetRect = target.getBoundingClientRect();
                var containerRect = scrollTarget.getBoundingClientRect();
                var targetPosition = scrollTarget.scrollTop + (targetRect.top - containerRect.top) - scrollOffset;
                setScrollTop(scrollTarget, targetPosition);
            }

            setTimeout(function () {
                isScrolling = false;
            }, 600);
        }

        document.addEventListener('click', function (e) {
            var link = e.target && e.target.closest && e.target.closest('.toc-container a[href*="#"]');
            if (!link) return;
            var href = link.getAttribute('href') || '';
            try {
                var url = new URL(href, location.href);
                if (url.pathname !== location.pathname) return;
                var hash = url.hash;
            } catch (_) {
                var hash = href.indexOf('#') >= 0 ? href.slice(href.indexOf('#')) : '';
            }
            if (!hash) return;
            var id = hash.replace(/^#/, '');
            var target = document.getElementById(decodeURIComponent(id));
            if (!target) return;
            e.preventDefault();
            scrollToHash(hash);
            if (history && history.replaceState) {
                history.replaceState(null, '', hash);
            } else {
                location.hash = hash;
            }
        });

        if (location.hash) {
            setTimeout(function () { scrollToHash(location.hash); }, 0);
        }
        window.addEventListener('hashchange', function () { scrollToHash(location.hash); });
    });
</script>
